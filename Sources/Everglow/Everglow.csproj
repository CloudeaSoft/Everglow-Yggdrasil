<?xml version="1.0" encoding="utf-8"?>
<Project Sdk="Microsoft.NET.Sdk">
	<Import Project="..\Shared.props" />
	<PropertyGroup>
		<DoILRepack>true</DoILRepack>
	</PropertyGroup>
	<ItemGroup>
		<ProjectReference Include="..\Everglow.Core\Everglow.Core.csproj" />
		<ProjectReference Include="..\Everglow.Function\Everglow.Function.csproj" />
		<ProjectReference Remove="Everglow.csproj" />
		<ILRepackExtraLibPath Include="@(Reference -> '%(RootDir)%(Directory)')" />
		<ILRepackExcludeAssemblies Include="SixLabors.ImageSharp.dll" />
	</ItemGroup>
	<ItemGroup>
	  <PackageReference Include="ILRepack.Lib.MSBuild" Version="2.1.18" />
	</ItemGroup>
	
	<UsingTask TaskName="BuildMod" AssemblyFile="$(TaskPath)" />
	<Target Name="PrepareBuildMod" BeforeTargets="Build">
		<ItemGroup>
			<!--在此Include可以使模组csproj对ImageFile和EffectFile的修改生效-->
			<AssetFile Include="@(ImageFile->'$(OutputPath)Assets\%(RelativeDir)%(Filename).rawimg')" />
			<AssetFile Include="@(EffectFile->'$(OutputPath)Assets\%(RelativeDir)%(Filename).xnb')" />
		</ItemGroup>
	</Target>

	<Target Name="BuildMod" AfterTargets="ILRepack" Inputs="@(ResourceFile);@(AssetFile);@(Compile);@(ModFile)" Outputs="$(ModDirectory)$(AssemblyName).tmod">
		<BuildMod ModSourceDirectory="$(MSBuildProjectDirectory)\" ModName="$(AssemblyName)" OutputDirectory="$(OutputPath)" ModDirectory="$(ModDirectory)" Configuration="$(Configuration)" IgnoreBuildFile="$(IgnoreBuildFile)" AssetFiles="@(AssetFile);" ResourceFiles="@(ResourceFile)" />
	</Target>
</Project>